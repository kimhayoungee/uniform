var i_no = $("#i_no").val();

window.onload = function () {
	            if (window.Notification) {
	                Notification.requestPermission();
	            }
	        }

var timeId = setInterval(function(){
	        	var size = $("#size").val();
	        	$.ajax({
	        		url:"/main/getMessageCnt.uni",
	        		type:"POST",
	        		data:{
	        			i_no:i_no
	        		},
	        		success:function(data){
	        			if(data>size){
	        				var cnt = data - size;
	        				$("#size").val(data);
	        				notify(cnt);
	        			}
	        		},
	        		error:function(e){
	        			alert("에러났다 > : " + e);
	        		}
	        	});
	        },10000);

var calendarId = setInterval(function(){	
					var getTime = getTime().tostring();
				 },1000);

function getTime(){
	var date = new Date();
	var year = date.getFullYear();
	var month = date.getMonth() + 1;
	var day = date.getDate();
	var hour = date.getHours();
	var minute = date.getMinutes();
	var second = date.getSeconds();
	
	var nowTime = year + "." + addzero(month) + "." + addzero(day) + " " + addzero(hour) + ":" + addzero(minute);
	console.log(nowTime + ":" + addzero(second));
	
	return nowTime;
}


function notify(cnt) {
	clearTimeout(timeId);
    if (Notification.permission !== 'granted') {
        alert('notification is disabled');
    }
    else {
        var notification = new Notification('새로운 쪽지가 도착했습니다', {
            icon: 'http://localhost:8088/pilotExam/pushWeb/img/calendar.gif',
            body: '새 쪽지 '+cnt+'개',
        });
        
        notification.onclick = function () {      
            location.href='/mm/goMessageMain.uni';
        };
    }
}


function addzero(num) {

	if(num < 10) { num = "0" + num; }

		return num;

}